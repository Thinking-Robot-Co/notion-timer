<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habit Tracker Widget</title>
  <style>
    /* Basic Reset & Fonts */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Arial', sans-serif;
      background: #f7f7f7;
      color: #333;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .quote {
      font-style: italic;
      text-align: center;
      margin-bottom: 20px;
      color: #555;
    }
    .view-toggle {
      text-align: center;
      margin-bottom: 15px;
    }
    .view-toggle button {
      margin: 0 5px;
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    .view-toggle button:hover {
      background: #0056b3;
    }
    .add-habit {
      text-align: center;
      margin-bottom: 20px;
    }
    .add-habit input {
      padding: 8px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .add-habit button {
      padding: 8px 16px;
      margin-left: 10px;
      border: none;
      border-radius: 5px;
      background: #28a745;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    .add-habit button:hover {
      background: #1e7e34;
    }
    .scroll-container {
      overflow-x: auto;
    }
    .habit-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    .habit-table th,
    .habit-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      min-width: 60px;
    }
    .habit-table th {
      background: #f2f2f2;
    }
    .habit-name {
      text-align: left;
      font-weight: bold;
      background: #fafafa;
    }
    .done {
      background: #28a745;
      color: #fff;
      font-weight: bold;
    }
    .not-done {
      background: #fff;
      color: #333;
    }
    .progress-container {
      width: 100%;
      background: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 5px;
    }
    .progress-bar {
      height: 10px;
      background: #28a745;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Habit Tracker</h1>
    <div class="quote" id="quote"></div>
    <div class="view-toggle">
      <button id="weeklyViewBtn">Weekly View</button>
      <button id="monthlyViewBtn">Monthly View</button>
    </div>
    <div class="add-habit">
      <input type="text" id="newHabitInput" placeholder="New Habit" />
      <button onclick="addHabit()">Add Habit</button>
    </div>
    <div class="scroll-container">
      <table class="habit-table" id="habitTable">
        <!-- Table will be generated by JavaScript -->
      </table>
    </div>
  </div>

  <script>
    /*************************************
     * 1. Setup: Default Habits & Quotes *
     *************************************/
    const defaultHabits = ["Reading", "Workout", "Meditation"];
    const quotes = [
      "Believe you can and you're halfway there.",
      "The only way to do great work is to love what you do.",
      "Don't watch the clock; do what it does. Keep going.",
      "The secret of getting ahead is getting started.",
      "It always seems impossible until it's done."
    ];
    document.getElementById("quote").textContent =
      quotes[Math.floor(Math.random() * quotes.length)];

    /*************************************
     * 2. Global Variables & localStorage *
     *************************************/
    // Current view: 'weekly' or 'monthly'
    let currentView = "weekly";

    // Habit data structure: { habitName: { "YYYY-MM-DD": true/false, ... }, ... }
    let habitData = JSON.parse(localStorage.getItem("habitTrackerData")) || {};
    // Initialize default habits if not already set
    defaultHabits.forEach((habit) => {
      if (!habitData[habit]) {
        habitData[habit] = {};
      }
    });

    // Save habit data to localStorage
    function saveData() {
      localStorage.setItem("habitTrackerData", JSON.stringify(habitData));
    }

    /*************************************
     * 3. Date Helpers                   *
     *************************************/
    // Get date range array based on currentView
    function getDateRange() {
      const dates = [];
      const today = new Date();
      if (currentView === "weekly") {
        // Assume week starts on Sunday
        const day = today.getDay(); // 0 (Sun) to 6 (Sat)
        const sunday = new Date(today);
        sunday.setDate(today.getDate() - day);
        for (let i = 0; i < 7; i++) {
          const date = new Date(sunday);
          date.setDate(sunday.getDate() + i);
          dates.push(date);
        }
      } else if (currentView === "monthly") {
        // Get all days of the current month
        const year = today.getFullYear();
        const month = today.getMonth(); // 0-indexed
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        for (let d = firstDay.getDate(); d <= lastDay.getDate(); d++) {
          dates.push(new Date(year, month, d));
        }
      }
      return dates;
    }
    // Format date as "YYYY-MM-DD"
    function formatDate(date) {
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, "0");
      const dd = String(date.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }

    /*************************************
     * 4. Render Habit Table             *
     *************************************/
    function renderTable() {
      const table = document.getElementById("habitTable");
      table.innerHTML = "";
      const dates = getDateRange();

      // Create header row
      const headerRow = document.createElement("tr");
      const habitHeader = document.createElement("th");
      habitHeader.textContent = "Habit";
      habitHeader.classList.add("habit-name");
      headerRow.appendChild(habitHeader);

      dates.forEach((date) => {
        const th = document.createElement("th");
        // Display short day name and date number
        const options = { weekday: "short", day: "numeric" };
        th.textContent = date.toLocaleDateString(undefined, options);
        headerRow.appendChild(th);
      });

      // Add a header for Progress %
      const progressHeader = document.createElement("th");
      progressHeader.textContent = "Progress";
      headerRow.appendChild(progressHeader);
      table.appendChild(headerRow);

      // Create a row for each habit
      Object.keys(habitData).forEach((habit) => {
        const row = document.createElement("tr");

        // Habit name cell
        const habitCell = document.createElement("td");
        habitCell.textContent = habit;
        habitCell.classList.add("habit-name");
        row.appendChild(habitCell);

        let doneCount = 0;
        dates.forEach((date) => {
          const cell = document.createElement("td");
          const dateStr = formatDate(date);
          const done = habitData[habit][dateStr] || false;
          cell.textContent = done ? "âœ”" : "";
          cell.className = done ? "done" : "not-done";
          cell.style.cursor = "pointer";
          cell.onclick = function () {
            // Toggle habit state for this date
            habitData[habit][dateStr] = !done;
            saveData();
            renderTable();
          };
          row.appendChild(cell);
          if (done) {
            doneCount++;
          }
        });

        // Create progress cell with percentage and progress bar
        const progressCell = document.createElement("td");
        const progressPercentage =
          dates.length > 0 ? Math.round((doneCount / dates.length) * 100) : 0;
        progressCell.innerHTML = `
          ${progressPercentage}% 
          <div class="progress-container">
            <div class="progress-bar" style="width: ${progressPercentage}%"></div>
          </div>
        `;
        row.appendChild(progressCell);
        table.appendChild(row);
      });
    }

    /*************************************
     * 5. View Toggle & Habit Adding     *
     *************************************/
    // Toggle between weekly and monthly views
    document
      .getElementById("weeklyViewBtn")
      .addEventListener("click", function () {
        currentView = "weekly";
        renderTable();
      });
    document
      .getElementById("monthlyViewBtn")
      .addEventListener("click", function () {
        currentView = "monthly";
        renderTable();
      });

    // Add a new habit
    function addHabit() {
      const input = document.getElementById("newHabitInput");
      const habitName = input.value.trim();
      if (habitName && !habitData[habitName]) {
        habitData[habitName] = {};
        input.value = "";
        saveData();
        renderTable();
      } else if (habitData[habitName]) {
        alert("Habit already exists!");
      }
    }
    // Expose addHabit to the global scope
    window.addHabit = addHabit;

    // Initial render
    renderTable();
  </script>
</body>
</html>
